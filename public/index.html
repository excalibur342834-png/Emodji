<script>
    class NetworkGame {
        constructor() {
            this.socket = null;
            this.roomId = null;
            this.playerId = null;
            this.playerName = 'Ð˜Ð³Ñ€Ð¾Ðº';
            this.isConnected = false;
            this.isHost = false;
            this.players = new Map();
            this.currentRoomId = null; // â† Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: Ð·Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°ÐµÐ¼ ID ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹
        }

        connect(roomId, playerName) {
            return new Promise((resolve, reject) => {
                this.socket = io();
                this.roomId = roomId;
                this.playerName = playerName;
                this.currentRoomId = roomId; // â† Ð—ÐÐŸÐžÐœÐ˜ÐÐÐ•Ðœ ID ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹
                
                this.socket.on('connect', () => {
                    this.isConnected = true;
                    this.playerId = this.socket.id;
                    
                    this.socket.emit('join_room', {
                        roomId: roomId,
                        playerName: playerName
                    });
                    
                    resolve({
                        success: true,
                        playerId: this.playerId,
                        isHost: false,
                        roomId: roomId
                    });
                });
                
                this.socket.on('player_joined', (data) => {
                    this.players.clear();
                    data.players.forEach(player => {
                        this.players.set(player.id, player);
                        if (player.id === this.playerId) {
                            this.isHost = player.isHost;
                        }
                    });
                    
                    if (this.onPlayersUpdate) {
                        this.onPlayersUpdate(Array.from(this.players.values()));
                    }
                });

                // Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹
                this.socket.on('room_state', (data) => {
                    if (this.onRoomState) {
                        this.onRoomState(data);
                    }
                });

                // Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¸Ð³Ñ€Ð¾Ð²Ñ‹Ñ… Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð²
                this.socket.on('game_object_added', (data) => {
                    if (this.onGameObjectAdded) {
                        this.onGameObjectAdded(data.object);
                    }
                });

                this.socket.on('game_object_removed', (data) => {
                    if (this.onGameObjectRemoved) {
                        this.onGameObjectRemoved(data.objectId);
                    }
                });

                this.socket.on('game_object_updated', (data) => {
                    if (this.onGameObjectUpdated) {
                        this.onGameObjectUpdated(data.object);
                    }
                });

                this.socket.on('clear_game_field', (data) => {
                    if (this.onClearGameField) {
                        this.onClearGameField();
                    }
                });
                
                this.socket.on('connect_error', (error) => {
                    reject(error);
                });
                
                setTimeout(() => {
                    if (!this.isConnected) {
                        reject(new Error('Connection timeout'));
                    }
                }, 5000);
            });
        }

        disconnect() {
            if (this.socket) {
                this.socket.disconnect();
            }
            this.isConnected = false;
            this.players.clear();
            // ÐÐ• Ð¾Ñ‡Ð¸Ñ‰Ð°ÐµÐ¼ currentRoomId Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¼Ð¾Ð¶Ð½Ð¾ Ð±Ñ‹Ð»Ð¾ Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒÑÑ
        }

        // Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: ÐœÐµÑ‚Ð¾Ð´Ñ‹ Ð´Ð»Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¸Ð³Ñ€Ð¾Ð²Ñ‹Ñ… Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð²
        sendGameObjectAdded(object) {
            if (!this.isConnected || !this.socket) return;
            this.socket.emit('game_object_added', { object });
        }

        sendGameObjectRemoved(objectId) {
            if (!this.isConnected || !this.socket) return;
            this.socket.emit('game_object_removed', { objectId });
        }

        sendGameObjectUpdated(object) {
            if (!this.isConnected || !this.socket) return;
            this.socket.emit('game_object_updated', { object });
        }

        sendClearGameField() {
            if (!this.isConnected || !this.socket) return;
            this.socket.emit('clear_game_field', {});
        }

        sendMessage(message) {
            if (!this.isConnected || !this.socket) return;
            
            this.socket.emit('chat_message', {
                message: message
            });
        }

        startGame() {
            if (!this.isConnected || !this.socket || !this.isHost) return;
            
            this.socket.emit('start_game', {});
        }

        sendCorrectAnswer(playerId) {
            if (!this.isConnected || !this.socket || !this.isHost) return;
            
            this.socket.emit('correct_answer', {
                playerId: playerId
            });
        }

        onMessage(callback) {
            if (this.socket) {
                this.socket.on('chat_message', (data) => {
                    callback(data);
                });
            }
        }

        onPlayersUpdate(callback) {
            this.onPlayersUpdate = callback;
        }

        onGameStart(callback) {
            if (this.socket) {
                this.socket.on('game_started', (data) => {
                    callback(data);
                });
            }
        }

        onMovieReveal(callback) {
            if (this.socket) {
                this.socket.on('movie_reveal', (data) => {
                    callback(data);
                });
            }
        }

        // Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: ÐšÐ¾Ð»Ð±ÑÐºÐ¸ Ð´Ð»Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸
        onRoomState(callback) {
            this.onRoomState = callback;
        }

        onGameObjectAdded(callback) {
            this.onGameObjectAdded = callback;
        }

        onGameObjectRemoved(callback) {
            this.onGameObjectRemoved = callback;
        }

        onGameObjectUpdated(callback) {
            this.onGameObjectUpdated = callback;
        }

        onClearGameField(callback) {
            this.onClearGameField = callback;
        }

        updatePlayerScore(playerId, points) {
            const player = this.players.get(playerId);
            if (player) {
                player.score += points;
            }
        }

        getPlayers() {
            return Array.from(this.players.values());
        }

        // Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ID ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹ Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ
        getCurrentRoomId() {
            return this.currentRoomId;
        }
    }

    class EmojinariumGame {
        constructor() {
            this.network = new NetworkGame();
            this.gameMode = 'single';
            this.isHost = false;
            
            this.gameField = document.getElementById('gameField');
            this.sectionsContainer = document.getElementById('sectionsContainer');
            this.movieTitle = document.getElementById('movieTitle');
            this.movieYear = document.getElementById('movieYear');
            this.loadingMovie = document.getElementById('loadingMovie');
            this.movieDisplay = document.getElementById('movieDisplay');
            this.emojiMenu = document.getElementById('emojiMenu');
            this.chatSection = document.getElementById('chatSection');
            this.chatMessages = document.getElementById('chatMessages');
            this.chatInput = document.getElementById('chatInput');
            this.sendBtn = document.getElementById('sendBtn');
            this.playersList = document.getElementById('playersList');
            this.roomIdInput = document.getElementById('roomId');
            
            this.objectCounter = 0;
            this.currentMovie = null;
            this.currentExpandedSection = null;
            this.sectionOrder = [];
            this.isRotating = false;
            this.rotationStartAngle = 0;
            this.rotationCurrentAngle = 0;
            this.gameObjects = new Map(); // â† Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: Ñ…Ñ€Ð°Ð½Ð¸Ð¼ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹
            
            this.emojiCategories = [/* ... Ð²Ð°Ñˆ ÑÐ¿Ð¸ÑÐ¾Ðº ÑÐ¼Ð¾Ð´Ð·Ð¸ ... */];

            this.initModal();
        }

        initModal() {
            const modal = document.getElementById('modeModal');
            const modeBtns = document.querySelectorAll('.mode-btn');
            const serverSettings = document.getElementById('serverSettings');
            const startBtn = document.getElementById('startBtn');
            const statusElement = document.getElementById('networkStatus');
            const createRoomBtn = document.getElementById('createRoomBtn');
            const joinRoomBtn = document.getElementById('joinRoomBtn');

            // Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ID ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹ Ð¿Ñ€Ð¸ Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¸
            const savedRoomId = this.network.getCurrentRoomId();
            if (savedRoomId) {
                this.roomIdInput.value = savedRoomId;
            }

            modeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    modeBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    this.gameMode = btn.dataset.mode;
                    
                    if (this.gameMode === 'network') {
                        serverSettings.classList.add('active');
                        statusElement.textContent = 'Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ...';
                        statusElement.className = 'status-message status-waiting';
                        
                        // Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÐºÐ½Ð¾Ð¿ÐºÑƒ "Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ID" ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð½Ð°Ñ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ð°
                        if (savedRoomId) {
                            this.showCopyRoomIdButton();
                        }
                    } else {
                        serverSettings.classList.remove('active');
                    }
                });
            });

            // Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: ÐšÐ½Ð¾Ð¿ÐºÐ° ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ID ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹
            this.showCopyRoomIdButton = () => {
                const copyBtn = document.createElement('button');
                copyBtn.className = 'action-btn copy-room-btn';
                copyBtn.textContent = 'ðŸ“‹ Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ID ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹';
                copyBtn.style.background = '#6f42c1';
                copyBtn.style.marginTop = '10px';
                copyBtn.addEventListener('click', () => {
                    navigator.clipboard.writeText(savedRoomId).then(() => {
                        statusElement.textContent = 'ID ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹ ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½!';
                        setTimeout(() => {
                            statusElement.textContent = 'Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ...';
                        }, 2000);
                    });
                });
                
                const actionButtons = document.querySelector('.action-buttons');
                if (actionButtons && !document.querySelector('.copy-room-btn')) {
                    actionButtons.parentNode.appendChild(copyBtn);
                }
            };

            // Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹
            createRoomBtn.addEventListener('click', async () => {
                const playerName = document.getElementById('playerName').value;
                let roomId = this.roomIdInput.value.trim();

                if (!roomId) {
                    roomId = 'room_' + Math.random().toString(36).substr(2, 8);
                    this.roomIdInput.value = roomId;
                }

                if (!playerName) {
                    statusElement.textContent = 'Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°ÑˆÐµ Ð¸Ð¼Ñ!';
                    return;
                }

                statusElement.textContent = 'Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñƒ...';
                createRoomBtn.disabled = true;
                joinRoomBtn.disabled = true;

                try {
                    const result = await this.network.connect(roomId, playerName);
                    
                    if (result.success) {
                        this.isHost = true;
                        statusElement.textContent = `ÐšÐ¾Ð¼Ð½Ð°Ñ‚Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð°! ID: ${roomId}`;
                        statusElement.className = 'status-message status-connected';
                        
                        this.roomIdInput.disabled = true;
                        this.showCopyRoomIdButton();
                        
                        setTimeout(() => {
                            this.startNetworkGame();
                        }, 2000);
                    }
                } catch (error) {
                    statusElement.textContent = 'ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹!';
                    createRoomBtn.disabled = false;
                    joinRoomBtn.disabled = false;
                }
            });

            // ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ðº ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ðµ
            joinRoomBtn.addEventListener('click', async () => {
                const roomId = this.roomIdInput.value.trim();
                const playerName = document.getElementById('playerName').value;

                if (!roomId) {
                    statusElement.textContent = 'Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ID ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹!';
                    return;
                }

                if (!playerName) {
                    statusElement.textContent = 'Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°ÑˆÐµ Ð¸Ð¼Ñ!';
                    return;
                }

                statusElement.textContent = 'ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÑÐµÐ¼ÑÑ Ðº ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ðµ...';
                createRoomBtn.disabled = true;
                joinRoomBtn.disabled = true;

                try {
                    const result = await this.network.connect(roomId, playerName);
                    
                    if (result.success) {
                        this.isHost = false;
                        statusElement.textContent = 'Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ð»Ð¸ÑÑŒ!';
                        statusElement.className = 'status-message status-connected';
                        
                        setTimeout(() => {
                            this.startNetworkGame();
                        }, 1000);
                    }
                } catch (error) {
                    statusElement.textContent = 'ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ñ‚ÑŒÑÑ! ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ID ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹.';
                    createRoomBtn.disabled = false;
                    joinRoomBtn.disabled = false;
                }
            });

            startBtn.addEventListener('click', async () => {
                if (this.gameMode === 'single') {
                    this.startSingleGame();
                }
            });
        }

        async startNetworkGame() {
            document.getElementById('modeModal').style.display = 'none';
            document.getElementById('gameHeader').style.display = 'block';
            document.getElementById('gameContainer').style.display = 'flex';
            document.getElementById('instructions').classList.add('active');
            
            if (this.isHost) {
                this.emojiMenu.classList.remove('hidden');
                this.chatSection.classList.add('active');
                await this.generateNewMovie();
                this.initSections();
            } else {
                this.emojiMenu.classList.add('hidden');
                this.chatSection.classList.add('active');
                this.movieDisplay.style.display = 'none';
                this.createPlayerPlaceholder();
            }
            
            this.initEventListeners();
            this.initNetworkListeners();
            this.updatePlayersList();
        }

        initNetworkListeners() {
            // ... ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ ...

            // Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¸Ð³Ñ€Ð¾Ð²Ð¾Ð³Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ
            this.network.onRoomState((data) => {
                if (data.movie && this.isHost === false) {
                    this.currentMovie = data.movie;
                }
                
                // Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð¸Ð³Ñ€Ð¾Ð²Ñ‹Ðµ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹
                if (data.gameObjects && data.gameObjects.length > 0) {
                    data.gameObjects.forEach(obj => {
                        this.createGameObjectFromData(obj);
                    });
                }
            });

            this.network.onGameObjectAdded((object) => {
                this.createGameObjectFromData(object);
            });

            this.network.onGameObjectRemoved((objectId) => {
                const object = this.gameObjects.get(objectId);
                if (object) {
                    object.remove();
                    this.gameObjects.delete(objectId);
                }
            });

            this.network.onGameObjectUpdated((object) => {
                const existingObject = this.gameObjects.get(object.id);
                if (existingObject) {
                    this.updateGameObjectFromData(existingObject, object);
                }
            });

            this.network.onClearGameField(() => {
                this.clearGameField();
            });
        }

        // Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¾Ð±ÑŠÐµÐºÑ‚Ð° Ð¸Ð· Ð´Ð°Ð½Ð½Ñ‹Ñ…
        createGameObjectFromData(objectData) {
            if (this.gameObjects.has(objectData.id)) return;

            const object = document.createElement('div');
            object.className = 'game-object';
            object.setAttribute('data-id', objectData.id);
            object.setAttribute('data-rotation', objectData.rotation);
            object.textContent = objectData.emoji;
            object.style.fontSize = objectData.fontSize + 'px';
            object.style.width = objectData.width + 'px';
            object.style.height = objectData.height + 'px';
            object.style.left = objectData.left + 'px';
            object.style.top = objectData.top + 'px';
            object.style.transform = `rotate(${objectData.rotation}deg)`;

            const placeholder = this.gameField.querySelector('.field-placeholder');
            if (placeholder) {
                placeholder.remove();
            }

            const controls = document.createElement('div');
            controls.className = 'object-controls';
            
            const rotateHandle = document.createElement('div');
            rotateHandle.className = 'rotate-handle';
            rotateHandle.title = 'Ð—Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð¸ Ñ‚ÑÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ñ';
            
            this.addRotationHandler(object, rotateHandle);
            controls.appendChild(rotateHandle);
            object.appendChild(controls);

            // Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ñ…Ð¾ÑÑ‚ Ð¼Ð¾Ð¶ÐµÑ‚ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ Ð¾Ð±ÑŠÐµÐºÑ‚Ð°Ð¼Ð¸
            if (this.isHost) {
                this.makeDraggable(object);
                this.addResizeHandler(object);
            }

            this.gameField.appendChild(object);
            this.gameObjects.set(objectData.id, object);
        }

        // Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾Ð±ÑŠÐµÐºÑ‚Ð° Ð¸Ð· Ð´Ð°Ð½Ð½Ñ‹Ñ…
        updateGameObjectFromData(object, objectData) {
            object.style.left = objectData.left + 'px';
            object.style.top = objectData.top + 'px';
            object.style.width = objectData.width + 'px';
            object.style.height = objectData.height + 'px';
            object.style.fontSize = objectData.fontSize + 'px';
            object.style.transform = `rotate(${objectData.rotation}deg)`;
            object.setAttribute('data-rotation', objectData.rotation);
        }

        // ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐž: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¸Ð³Ñ€Ð¾Ð²Ð¾Ð³Ð¾ Ð¾Ð±ÑŠÐµÐºÑ‚Ð° Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸ÐµÐ¹
        createGameObject(emoji, x, y) {
            const placeholder = this.gameField.querySelector('.field-placeholder');
            if (placeholder) {
                placeholder.remove();
            }

            const objectId = ++this.objectCounter;
            const object = document.createElement('div');
            object.className = 'game-object';
            object.setAttribute('data-id', objectId);
            object.setAttribute('data-rotation', '0');
            object.textContent = emoji;
            object.style.fontSize = '50px';
            object.style.width = '90px';
            object.style.height = '90px';

            const rect = this.gameField.getBoundingClientRect();
            const posX = x - rect.left - 45;
            const posY = y - rect.top - 45;

            object.style.left = `${Math.max(20, posX)}px`;
            object.style.top = `${Math.max(20, posY)}px`;

            const controls = document.createElement('div');
            controls.className = 'object-controls';
            
            const rotateHandle = document.createElement('div');
            rotateHandle.className = 'rotate-handle';
            rotateHandle.title = 'Ð—Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð¸ Ñ‚ÑÐ½Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ñ';
            
            this.addRotationHandler(object, rotateHandle);
            controls.appendChild(rotateHandle);
            object.appendChild(controls);

            this.makeDraggable(object);
            this.addResizeHandler(object);
            this.gameField.appendChild(object);
            this.gameObjects.set(objectId, object);

            // Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ°Ð¼Ð¸
            if (this.gameMode === 'network' && this.isHost) {
                const objectData = {
                    id: objectId,
                    emoji: emoji,
                    left: parseInt(object.style.left),
                    top: parseInt(object.style.top),
                    width: parseInt(object.style.width),
                    height: parseInt(object.style.height),
                    fontSize: parseInt(object.style.fontSize),
                    rotation: 0
                };
                this.network.sendGameObjectAdded(objectData);
            }

            return object;
        }

        // ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐž: Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð¾Ð±ÑŠÐµÐºÑ‚Ð° Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸ÐµÐ¹
        removeGameObject(object) {
            const objectId = parseInt(object.getAttribute('data-id'));
            object.remove();
            this.gameObjects.delete(objectId);

            // Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ°Ð¼Ð¸
            if (this.gameMode === 'network' && this.isHost) {
                this.network.sendGameObjectRemoved(objectId);
            }

            if (this.gameField.querySelectorAll('.game-object').length === 0) {
                this.showPlaceholder();
            }
        }

        // ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐž: ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð¿Ð¾Ð»Ñ Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸ÐµÐ¹
        clearGameField() {
            this.gameField.innerHTML = '';
            this.gameObjects.clear();
            this.objectCounter = 0;
            this.showPlaceholder();

            // Ð”ÐžÐ‘ÐÐ’Ð›Ð•ÐÐž: Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ Ð¸Ð³Ñ€Ð¾ÐºÐ°Ð¼Ð¸
            if (this.gameMode === 'network' && this.isHost) {
                this.network.sendClearGameField();
            }
        }

        // ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐž: ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð´Ð²Ð¾Ð¹Ð½Ð¾Ð³Ð¾ ÐºÐ»Ð¸ÐºÐ°
        handleDoubleClick(e) {
            if (e.detail === 2) {
                const gameObject = e.target.closest('.game-object');
                if (gameObject) {
                    this.removeGameObject(gameObject);
                }
            }
        }

        // ... Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ ...
    }

    // Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ CSS Ð´Ð»Ñ ÐºÐ½Ð¾Ð¿ÐºÐ¸ ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
    const style = document.createElement('style');
    style.textContent = `
        .copy-room-btn {
            background: #6f42c1 !important;
            color: white !important;
        }
        .copy-room-btn:hover {
            background: #5a32a3 !important;
        }
    `;
    document.head.appendChild(style);

    document.addEventListener('DOMContentLoaded', () => {
        new EmojinariumGame();
    });
</script>
